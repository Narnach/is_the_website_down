#!/usr/bin/env ruby
root_dir = File.expand_path(File.join(File.dirname(__FILE__),'..'))
lib_dir = File.join(root_dir, 'lib')
$LOAD_PATH.unshift(lib_dir) unless $LOAD_PATH.include?(lib_dir)
require 'rubygems'
require 'is_the_website_down'
require 'sinatra'

set :views, File.join(root_dir, 'views')
set :environment, :production
websites = File.readlines(File.join(root_dir,'config','sites.txt')).map {|site| IsTheWebsiteDown::Website.new(site)}
locals = {
  :title => "Is the website down?",
  :websites => websites
}
get '/' do
  websites.each {|site| site.poll}
  haml :index, :locals => locals
end